# 基本信息:

## 服务器基本信息
ljs目前使用easemob的服务器。 本文档中的所有url都需要换成

  http://api.easemob.com
  
已创建了一个org和app, 具体信息是

    curl -X POST -i  "http://api.easemob.com/management/organizations" -d '{"organization":"ljs","username":"ljs_admin","name":"LJS Admin","email":"admin@ljs.com","password":"1234567890"}'
    curl -X POST -i -H "Authorization: Bearer YWMtI-n89nqGEeOOXyXq3bWeNwAAAUOj8rinBuWhDVWIeFPgEotHz6AOCflJ0AA" "http://api.easemob.com/management/organizations/ljs/applications" -d '{"name":"ljs"}'
        
Usergrid管理后台的登录地址是：

    http://api.easemob.com/management/organizations 

## Usergrid返回的response的数据结构。

请注意，在这个reponse的json数据中，只有"entities"才是真正的数据体，并且总是一个数组类型。

    {
        "action" : "post",                                     //请求类型，可以为get|post|put|delete
        "application" : "3bec9de0-6abe-11e3-8606-41e5b3c17b39",//请求的app的UUID.在usergrid中每个app即可通过他的appkey唯一标识，也可以通过他的uuid唯一标识
        "params" : { },                                        //请求的参数。
        "path" : "/users",                                     //请求的请求路径。
        "uri" : "http://210.76.97.29:8080/hoho/hoho/users",    //请求URI。
        "entities" : [ {                                       //response的数据体。总是一个数组。
          "uuid" : "98b746e0-6ac0-11e3-914b-0b6cc7bc5592",     //返回的数据entity的uuid
          "type" : "user",                                     //返回的数据entity的类型
          "created" : 1387686117965,                           //返回的数据entity的创建时间
          "modified" : 1387686117965,                          //返回的数据entity的最后更新时间
          "username" : "admin",                                //返回的数据entity的是user类型。username是user类型entity的主键。
          "activated" : true                                   //返回的数据entity的是否被激活
        } ],
        "timestamp" : 1387686117951,                           //请求的时间戳。
        "duration" : 207,                                      //请求所用时常
        "organization" : "hoho",                               //请求的app所属的org
        "applicationName" : "hoho"                             //请求的app的名字
    }

## 邻居说帖子的数据结构

    { 
        "actor" :{
            "uuid | username" :"当前发送这个段子的人的uuid或者username, 和下面不同的是这个是谁在执行这个操作"
            "author_username" : "段子中要显示的发布人的username(是用户的primarykey)。用来在界面上显示段子的发送人, 虽然实际发送人都是admin, 但是界面上可以显示不同的名字",
            "author_nick" : "段子中要显示的发布人的昵称",
            "author_avator" : "段子中要显示的发布人的头像",
        } 
        "content" : "段子内容",
        "published" : "发布时间--UTC, 这个server会自动创建, 在post的时候不需要添加",
        "verb" : "post 表示段子, comment表示评论",
        "image" : ["http://xxx.img", "http://yyy.jpg"],    //表示一个能够下载到段子中图片的地址的数组。照片可以为多个
        "audio" : "这里的值应该是个指向语音文件的url。",
        "audio_length" : "语音段子的长度。这样客户端可在不下载语音段子的情况就能显示语音段子的长度。长度值为int类型，单位为秒。如果因为某种原因，语音段子的长度未知，该值可以不出现，也可以为0",
        "topic_tag" ： "话题分类标签。",
        "play_count" ： "该属性必须有。语音的播放次数。缺省为0",
        "like_count" ： "该属性必须有。赞的数量。缺省为0",
        "dislike_count": "该属性必须有。踩的数量。缺省为0",
        "comment_count": "该属性必须有。评论的数量。缺省为0",
        "like_byme" ： "1 表示我（当前发出请求的用户）顶过, 0 我没有顶过",
        "dislike_byme": "1 表示我（当前发出请求的用户）踩过, 0 我没有踩过",
        "collect_byme": "1 表示我（当前发出请求的用户）收藏过, 0 我没有收藏过"
    }

## 邻居说中用户(User)的数据结构

      { 
          "username" : "这个是用户的primarykey. 必须是英文字母数字下划线横线的组合，规则如下："^[a-z0-9_-]{3,15}$",
          "nick" : "用户昵称，可以为中文。",
          "avator" : "头像在图片服务器上的路径",
          "signature" : "个性签名",
          "sex" : "性别. F|M|U.不区分大小写",
          "community":{            //用户所属的社区。为一个数组。一个用户可以属于多个社区
          	"communityName":"863520001",
	  	"communityNick":"天泰城",
	        "building":"2"            //用户所属的社区的楼号。   
           }
          "mobile" : "绑定的手机号"
      }

## 邻居说中评论的数据结构

    { 
        "actor" : "刘少壮--发布人, 同样,这个属性由server维护",
        "author_nick" : "显示的名称或者nickname",
        "content" : "评论内容",
        "published" : "发布时间--UTC",
        "audio" : "这里的值应该是个指向语音文件的url。",
        "audio_length" : "语音段子的长度。这样客户端可在不下载语音段子的情况就能显示语音段子的长度。长度值为int类型，单位为秒。如果因为某种原因，语音段子的长度未知，该值可以不出现，也可以为0",
        "verb" : "post 表示段子, comment表示评论",
        "to" : "被评论的段子的UUID" 
    }
  

## 邻居说中社区的数据结构

    { 
        "path" : "社区代码, 这个是社区的primarykey. 比如865320001，其中86532为国家区号加地区区号，0001为小区在当地的编号",
        "nick" : "社区显示用的名称，可以为中文",
        "province" : "小区所属省份",
        "city" : "小区所属城市",
        "district" : "小区所属区",
        "address" : "小区所属具体地址"
        "group_type" : "community" //表明这个group是一个社区类型的group, 用来和其它类型的group做区分
    }

注, 这个社区在usergrid里面是一个group



## 设置未登陆用户也能获取小区列表或者模糊查询已有小区

需要未登录用户(拥有guest权限)能够读取小区的话, 只需要guest role能够访问 *GET /groups/* 

可参考 _usergrid/role.md_ 文档, 给guest 角色添加 _get /groups_和_get /groups/*_ 的权限

    curl -X POST -i -H "Authorization: Bearer YWMtkE-JmINAEeOX1gM4bvTCogAAAUPdJj0YP-OXvYeccENl-3ITkL8ci_y6KWU" "http://api.easemob.com/ljs/ljs/roles/guest/permissions" -d '{ "permission" : "get:/groups/*" }'
    curl -X POST -i -H "Authorization: Bearer YWMtkE-JmINAEeOX1gM4bvTCogAAAUPdJj0YP-OXvYeccENl-3ITkL8ci_y6KWU" "http://api.easemob.com/ljs/ljs/roles/guest/permissions" -d '{ "permission" : "get:/groups" }'

需要未登录用户(拥有guest权限)能够申请新建小区的话, 只需要guest role能够访问 *POST /newcommunties/* 

    curl -X POST -i -H "Authorization: Bearer YWMtI-n89nqGEeOOXyXq3bWeNwAAAUOj8rinBuWhDVWIeFPgEotHz6AOCflJ0AA" "http://api.easemob.com/ljs/ljs/roles/guest/permissions" -d '{ "permission" : "post:/newcommunities/*" }'


## 设置未登陆用户也能查询用户手机号码是否已经存在

需要未登录用户(拥有guest权限)能够读取用户的话, 只需要guest role能够访问 *GET /users/* 

可参考 _usergrid/role.md_ 文档, 给guest 角色添加 _get /users_和_get /users/*_ 的权限

    curl -X POST -i -H "Authorization: Bearer YWMtX_F1CIp2EeOPcNsnrn7q4gAAAUQMZvIwGnr5w70cI6F3u-zIHGDlkLAYGLY" "http://api.easemob.com/ljs/ljs/roles/guest/permissions" -d '{ "permission" : "get:/users/*" }'
    curl -X POST -i -H "Authorization: Bearer YWMtX_F1CIp2EeOPcNsnrn7q4gAAAUQMZvIwGnr5w70cI6F3u-zIHGDlkLAYGLY" "http://api.easemob.com/ljs/ljs/roles/guest/permissions" -d '{ "permission" : "get:/users" }'



## 如何做分页

系统默认返回最多100个结果。参见 dev-docs/usergrid/使用limit和cursor  
<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Easemob - 简洁、直观、强悍、移动设备优先的前端开发框架，让Mobile开发更迅速、简单。" name="description">
    <meta content="Easemob" name="author">
    <title>Easemob推送 | Easemob</title>
    <link href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/docs.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/highlight.js/7.3/styles/github.min.css" rel="stylesheet">
    <style type="text/css">
      body{font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","WenQuanYi Micro Hei",sans-serif;}
      h1, .h1, h2, .h2, h3, .h3, h4, .h4, .lead {font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","Microsoft YaHei UI","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;}
      pre code { background: transparent; }
      @media (min-width: 768px) {
          .bs-docs-home .bs-social,
          .bs-docs-home .bs-masthead-links {
            margin-left: 0;
          }
      }
    </style>
    <!--[if lt IE 9]
    script  type='text/javascript' src=("/assets/js/ie8-responsive-file-warning.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js" ) -->
    <link href="/assets/ico/apple-touch-icon-144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144">
    <link href="/assets/ico/favicon.ico" rel="shortcut icon">
  </head>
  <body><a class="sr-only" href="#content"> Skip to main content</a>
<header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-target=".bs-navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href=""> Easemob</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li class="active">
          <a href=""> 首页</a>
        </li>
        <li>
          <a href="/quickstart/"> 入门</a>
        </li>
        <li>
          <a href="/docs/"> 文档</a>
        </li>
        <li>
          <a href="/download/"> SDK下载</a>
        </li>
        <li>
          <a href="/forum/"> 开发者论坛</a>
        </li>
        <li>
          <a href="/blog/"> 博客          </a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/signin/"> 登陆</a>
        </li>
        <li>
          <a href="/signup/"> 注册</a>
        </li>
      </ul>
    </nav>
  </div>
</header><div id="content" class="bs-header">
  <div class="container">
    <h1>
      Easemob推送
    </h1>
    <p>
      Easemob推送, 在1秒内推送上万条数据, 并且支持tag等多维度推送
    </p>
  </div>
</div>
<div class="container bs-docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="bs-sidebar hidden-print" role="complementary">
        <ul class="nav bs-sidenav">
          <li>
            <a href="#download"> 下载Bootstrap</a>
            <ul class="nav">
              <li>
                <a href="#download-compiled"> 编译后的CSS、JS和字体文件</a>
              </li>
              <li>
                <a href="#download-additional"> 额外的下载渠道</a>
              </li>
              <li>
                <a href="#download-cdn"> Bootstrap CDN</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#whats-included"> 包含了哪些文件</a>
            <ul class="nav">
              <li>
                <a href="#whats-included-precompiled"> 编译版</a>
              </li>
              <li>
                <a href="#whats-included-source"> 源码</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#template"> 基本模版</a>
          </li>
          <li>
            <a href="#examples"> 案例</a>
          </li>
          <li>
            <a href="#disable-responsive"> 禁用响应式布局</a>
          </li>
          <li>
            <a href="#migration"> 从2.x升级到3.0版本</a>
            <ul class="nav">
              <li>
                <a href="#migration-classes"> 被修改的主要class</a>
              </li>
              <li>
                <a href="#migration-new"> 新增class</a>
              </li>
              <li>
                <a href="#migration-dropped"> 被移除的class</a>
              </li>
              <li>
                <a href="#migration-notes"> 额外注意</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#browsers"> 浏览器支持</a>
          </li>
          <li>
            <a href="#third-parties"> 对第三方组件的支持</a>
          </li>
          <li>
            <a href="#accessibility"> 可访问性</a>
          </li>
          <li>
            <a href="#license-faqs"> 许可证FAQ</a>
          </li>
          <li>
            <a href="#customizing"> 定制Bootstrap</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="col-md-9" role="main"><h2 id="section">认证</h2>

<p>当前还没有更好的认证方法, 例如像激光推送的那种使用api key的方式, 在我们的服务中, 需要对所有的REST请求进行HTTP BASIC AUTH, 用户名是 <em>admin</em>, 密码是 <em>easemob-push</em></p>

<h2 id="section-1">注册设备</h2>

<pre><code>$ curl -d proto=apns \
       -d token=FE66489F304DC75B8D6E8200DFF8A456E8DAEACEC428B427E9518741C92C6660 \
       -d lang=zh \
       -d badge=0 \
       --header 'appkey: 1234567890' \
       http://223.202.120.59:7874/subscribers
</code></pre>

<p>系统会返回一个json</p>

<pre><code>{
  "proto": "apns",
  "token": "7ee2400ca162be71eebafdb46056ff0afc973c8fab272d2b6627df4f86bac457",
  "lang": "zh",
  "badge": 0,
  "updated": 1379343042,
  "created": 1379343042,
  "id": "UeJvEkzXLqA"
}	       
</code></pre>

<p>需要把返回值中的_id_保存下来</p>

<p>如果是xmpp的话, 那么post的数据中可以带上jiduser, 如果带上了的话, 那么系统就会使用这个jid, 否则, 系统会注册一个新的xmpp 账号, jid就是返回的id, 密码也是一样的</p>

<p>同时, 因为有了这个jiduser, 那么就可以使用 <em>/sendmsg/:jiduser</em> 的形式来给这个jid做单点推送了
## Ping</p>

<p>当一个app注册之后, 每次这个app启动的时候, 都需要ping push server, 来确保server知道这个设备还存在着, 不然, server有可能会把这个设备给移除掉 (目前没有做)</p>

<pre><code>curl -d lang=zh -d badge=0 http://223.202.120.59:7874/subscriber/UeJvEkzXLqA
</code></pre>

<p>把一个设备/app从push server中移出 (例如, app中的设置关闭了推送通知), 那么可以通过 (目前没有从xmpp server中删除掉push server创建的账号)</p>

<pre><code>curl -X DELETE http://223.202.120.59:7874/subscriber/UeJvEkzXLqA
</code></pre>

<h2 id="subscriptions">Subscriptions</h2>

<p>对于每个app, 它可以选择订阅到多个topic中, 从而接受这些topic中的push消息, 例如, 对于一个新闻类型的app, 它可以让用户来选择感兴趣的领域来接收推送消息</p>

<pre><code>curl -X POST http://223.202.120.59:7874/subscriber/UeJvEkzXLqA/subscriptions/sport		
</code></pre>

<p>也可以通过 <strong>DELETE</strong> 来取消订阅某一个topic的消息 (<strong>TODO xmpp is not support this yet</strong>)</p>

<p>或者, 也可以通过一次调用来完成订阅多个topic的操作 (<strong>TODO</strong> xmpp is not supported yet)</p>

<pre><code>curl -H 'Content-Type: application/json' -d '{"sport":{}, "music":{}}' http://223.202.120.59:7874/subscriber/UeJvEkzXLqA/subscriptions
</code></pre>

<p>这样, 对于每个app user, 可以自动的把他们注册到某些topic, 从而发送全局消息, 例如先获取用户的地理位置, 然后把他们注册到对应的城市中, 或者国家中等等</p>

<p>查看一个app都订阅了哪些topics</p>

<pre><code>GET /subscriber/UeJvEkzXLqA/subscriptions
</code></pre>

<h2 id="event-message">Event message</h2>

<p>现在, 我们就可以给设备发送推送消息了, 注意, 消息是发送到topic的, 这里我们(推送消息的发送方)不需要知道topic中有哪些设备, 如果一个设备都没有的话, push server会直接忽略的</p>

<pre><code>curl -d title=Test%20message http://223.202.120.59:7874/event/sport	
</code></pre>

<p>上面的例子只使用一个 <em>title</em>, 这个的值会被发送到ios的通知栏显示出来</p>

<p>标准的消息格式目前支持:</p>

<p>{
title: "this is a title",
msg: "the internal message",
sound: "the sound app should play when got this notifer",
data: {
//here can be anyting, the value of 'data' attribute, either a sub-json, or a string
}
}	</p>

<p>只有title是必须的, data属性的值可以是任何合法的json值, 这部分数据只有在用户相应了通知之后, 打开app, app才会得到</p>

<h2 id="section-2">单点推送</h2>

<p>通过这个功能, 我们可以根据push id来推送给单独的一个人</p>

<pre><code>POST /send/:push_id {}
</code></pre>

<p>这里POST的数据遵循上面event message部分的规则</p>

<p>当前这个单点推送只支持ios	</p>

    </div>
  </div>
</div><footer class="bs-footer" role="contentinfo">
      <div class="container">
        <p class="text-muted">
          做中国最好的BaaS
        </p>
      </div>
    </footer>
    <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="http://cdn.bootcss.com/holder/2.0/holder.min.js"></script>
    <script src="http://cdn.bootcss.com/highlight.js/7.3/highlight.min.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>
    <script src="/assets/js/application.js"></script>
  </body>
</html>